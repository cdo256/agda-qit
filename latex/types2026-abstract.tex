% Options for packages loaded elsewhere
\PassOptionsToPackage{unicode}{hyperref}
\PassOptionsToPackage{hyphens}{url}
\documentclass[a4paper,UKenglish,cleveref, autoref, thm-restate]{lipics-v2021}
\usepackage{mathpartir}
\usepackage{amsmath}
\bibliographystyle{plainurl}

\providecommand{\tightlist}{%
  \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}

\title{Constructing QITs from Quotients}

\author{Thorsten Altenkirch}{University of Nottingham, UK}{thorsten.altenkirch@nottingham.ac.uk}{https://orcid.org/0000-0002-6582-5025}{}
\author{Christina O'Donnell}{University of Nottingham, UK}{psxco3@nottingham.ac.uk}{[ORCID]}{Supported by the Engineering and Physical Sciences Research Council (EPSRC) Doctoral Landscape Award [Grant Ref: EP/YXXXXXX/1].}

\authorrunning{T. Altenkirch and C. D. O'Donnell}
\Copyright{Thorsten Altenkirch and Christina O'Donnell}

\ccsdesc[500]{Theory of computation~Type theory}
\ccsdesc[300]{Theory of computation~Constructive mathematics}
\ccsdesc[300]{Theory of computation~Logic and verification}

\keywords{Quotient Inductive Types, W-Types, Homotopy Type Theory, Agda, Constructive Mathematics}

% Optional: Link to the ArXiv version or repository if applicable
%\relatedversion{Full version hosted on arXiv: \url{https://arxiv.org/abs/xxxx.xxxxx}}

\supplement{Source code available at \url{https://github.com/cdo256/agda-qit}}

\begin{document}

\maketitle

\section{Motivation}\label{motivation}

Quotient Inductive Types (QITs) are a central mechanism for specifying
datatypes equipped with identifications in set-truncated Homotopy Type
Theory \cite{hott2013-book}. They support a wide range of fundamental
constructions, including the HoTT reals \cite{hott2013-book}, partiality
monads \cite{altenkirch2017-partiality-monad}, and ordinal-like
structures \footnote{TODO: Citaiton}.

Despite their expressive power, QITs present significant foundational
difficulties. Shulman and Lumsdaine established a no-go theorem showing
that certain QITs, including Brower's standard definition of the countable
ordinals, cannot be constructed using quotients alone
\cite{lumsdaine2020-semantics-higher-inductive}. This suggests that some
form of infinitary principle or choice is unavoidable in a constructive
metatheory, at least in the general case.

Fiore, Pitts, and Steenkamp subsequently showed that a broad class of
QITs, which they call Quotient-W Types (QW types), admit an Initial
Algebra semantics assuming the Weak Initial Set of Covers principle (WISC)
\cite{fiore2022-quotients-inductive-types}. Their result
recovers many important examples, including the extensional countable
ordinals. However, WISC remains a non-constructive choice principle
\cite{vandenberg2012-wisc-axiom}, and its necessity is poorly
understood. In particular, it is unclear which features of a QIT
genuinely require choice, and which arise from limitations of existing
proof techniques.

This leads to our central research question:

\begin{quote}
	Which quotient-W types can be constructed fully constructively, without
	assuming any form of choice?
\end{quote}

%TODO: Define point and path constructor in general?
%TODO: Reword?
Our approach is to study a 'just-tricky-enough' example to test the need
for WISC in defining QITs, while still being as simple as possible. We then try
to prove that these exhibit an $(Q,sup)$ initial algebra---a categorical structure that
represents that there is exists a recursor (morphism between algebras), and that
that recursor is unique (no `extra stuff' in Q beyond what is needed to
represent the signature). Our plan was to exploritoriliy formalize it in Agda,
until we got stuck, and then to see exactly why WISC was needed in this case,
and see if we could determine a weaker principle, that was more justified
constructively. What we discovered, to our surprise, is that the step that Fiore et al. used WISC
could actually be shown to be fully constructive. We postulate that a large
class of QITs can be exhibited constructively.

%TODO: Define WISC?

\section{Mobiles}
The example that we chose--`mobiles'--have just two point constructors and one
path constructors, making it much simpler than the other 'hard' cases we
surveyed, while still being considered as challenging from a constructability
standpoint.

We define *mobiles* as well-founded trees quotiented by permutation at each
level. (TODO: Figures). Specifically,

$$
\begin{array}{l@{\; }l@{\quad}l}
  \multicolumn{3}{l}{\textbf{data } \mathsf{Mobile} : \mathcal{U} \textbf{ where}} \\
  \quad \mathsf{leaf}        & : \mathsf{Mobile} \\
  \quad \mathsf{node}(f)     & : \mathsf{Mobile}                                  & \forall f : \mathsf{Mobile}^I \\
  \quad \mathsf{perm}(\pi,f) & : \mathsf{node}(f) = \mathsf{node}(f \circ \pi) & \forall \pi : I \cong I ;\, f : \mathsf{Mobile}^I
\end{array}
$$

for some $I:\mathcal{U}$ where $\mathsf{Mobile}^I$ represents functions from the
branching index set $I$ and $\mathsf{Mobile}$'s. This has a clean, natural
presentation that fits in three lines, unlike others which require auxillary
data types, or stronger recursion semantics. %TODO: Terminology?

\section{Main Idea}\label{main-idea}

We briefly recall the framework of quotient-W types introduced by Fiore,
Pitts, and Steenkamp \cite{fiore2022-quotients-inductive-types}. A QW
signature consists of a container (representing branching structure) and a set
of equations over the container. From such a signature, Fiore et al.~construct a diagram of
approximations indexed by a size structure
\cite{fiore2022-quotients-inductive-types}. Intuitively, this diagram
represents successive stages of the quotient construction, where each
stage gives the proofs available within a bounded depth. The desired QW
type is obtained as the colimit $Q$ of this diagram.

Fiore et al.~show this that this diagram is in fact an initial algebra: having a
unique recursor, thereby showing that the structure using (indexed) WISC
\cite{fiore2022-quotients-inductive-types}. In particular,
WISC is crucial in proving *cocontinuity*, this case meaning that the
constructors lift to the quotiented form, and that $Q$ is closed under all
constructors.

The proof in Fiore et al.~relies on WISC to select a cover to size-bound the
family of subtrees, enabling the construction of inverse maps witnessing
this isomorphism.

Our work revisits this step. We observe that the need for WISC arises
precisely when the equations allow arbitrarily deep inspection of terms,
as in the extensional ordinal example. When all equations are
depth-bounded, the required coherence data can instead be constructed by
well-founded recursion on a fixed ordinal bound \(\alpha\), avoiding any
appeal to choice.

%TODO: Cut?
%We formalise the notion of locality by assigning a \emph{rank} function
%
%\[ \mathrm{rank} : T_\Sigma X \to \mathcal{O} \]
%
%measuring the height of the underlying tree. An equation system is said
%to be \(\alpha\)-local if, for every equation \(e : E\), both sides
%\(l(e)\) and \(r(e)\) have rank \emph{at most} a fixed ordinal
%\(\alpha\). Intuitively, this means that every generating equation only
%inspects structure up to depth \(\le \alpha\).
%
%Our main theorem is that \(\alpha\)-local QW signatures admit fully
%constructive initial algebra semantics.

%\emph{Theorem} Let \(\Sigma\) be a QW signature whose equations are
%\(\alpha\)-local. Then the associated quotient-W type exists as an
%initial algebra, and its construction does not require WISC or any other
%choice principle.
%
%The proof follows the outline of Fiore--Pitts--Steenkamp
%\cite{fiore2022-quotients-inductive-types}, but replaces the use of WISC
%in the inverse map by offsetting by a bound ordinal \(\alpha\), giving a
%constructable function between term bound and maximum proof depth,
%giving cocontinuity. This construction is fully constructive and does
%not require any choice principles.
%
%Our analysis explains why certain examples genuinely require choice. In
%the case of extensional ordinals, equality is defined by mutual
%containment of downward closures, which requires unbounded descent into
%subtrees \cite{fiore2022-quotients-inductive-types}. No ordinal bound
%\(\alpha\) suffices, and the quotient is therefore non-local. This
%accounts for the essential use of WISC in the construction of ordinals.
%
%More generally, any quotient whose generators quantify over arbitrarily
%deep substructures or require unbounded transitive closure will fall
%outside the \(\alpha\)-local fragment.
%
%Technically, we construct stratified diagrams indexed by ordinals below
%\(\alpha\), and show that all cones factor through a bounded stage.
%Plumpness of the ordinal ensures the existence of suprema for such
%cones, yielding cocontinuity without choice.

\section{Conclusion}\label{conclusion}

We identify bounded locality as a structural criterion characterising
which quotient-W types admit fully constructive constructions. This
explains when choice principles such as WISC are genuinely necessary,
and when they can be avoided. Our results show that many infinitary
quotients previously thought to require choice are, in fact,
constructible in a purely constructive setting.

Our work builds on the QW framework of Fiore, Pitts, and Steenkamp
\cite{fiore2022-quotients-inductive-types}, and complements the no-go
results of Shulman and Lumsdaine
\cite{lumsdaine2020-semantics-higher-inductive}. It is also related to
Pitts and Steenkamp's notion of infinitary inflation
\cite{steenkamp2021-phd-thesis}, which similarly isolates sources of
non-constructivity in inductive definitions.

Future directions include formalising the locality theorem stated above,
and extending the analysis to indexed QW types
\cite{altenkirch2018-quotient-inductive-inductive}.

\bibliography{master}

\end{document}
